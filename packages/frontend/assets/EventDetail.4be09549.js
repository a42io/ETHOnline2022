import{a as c,an as U,j as t,f as k,c as V,aR as _,aF as Q,r as n,u as X,aG as Z,aS as ee,aT as te,aH as se,d as h,P as ne,C as ae,aJ as oe,aK as re,e as ie,as as $,T as O,S as M,B as x,L as w,I as b,M as ce,aU as le}from"./index.2bd8f465.js";import{u as de}from"./useIsMountedRef.f86cd63f.js";import{j as ue,M as pe,F as fe,I as he,S as ge}from"./EventNewEventForm.cf173463.js";import{H as me}from"./HeaderBreadcrumbs.20d41652.js";import{S as g}from"./Skeleton.f97d6b3e.js";import"./icon_plan_premium.72350fd4.js";import"./illustration_404.7ecc1d11.js";import"./transition.1cb4ca21.js";import"./warn-once.5522b8da.js";function xe(){return c(U,{children:[t(g,{width:"100%",height:560,variant:"rectangular",sx:{borderRadius:2}}),c(k,{sx:{mt:3,display:"flex",alignItems:"center"},children:[t(g,{variant:"circular",width:64,height:64}),c(k,{sx:{flexGrow:1,ml:2},children:[t(g,{variant:"text",height:20}),t(g,{variant:"text",height:20}),t(g,{variant:"text",height:20})]})]})]})}function Te(){const{themeStretch:B}=V(),p=de(),{eventId:a}=_(),v=Q(),[o,H]=n.exports.useState(null),{address:l}=X(),{data:E}=Z({address:l}),{isAuthenticated:r}=ee(),{signMessageAsync:P}=te(),{enqueueSnackbar:S}=se(),[W,y]=n.exports.useState(null),[z,T]=n.exports.useState(!0),[d,D]=n.exports.useState(""),[G,A]=n.exports.useState(!1),[I,L]=n.exports.useState([]),[f,R]=n.exports.useState([]),[m,Y]=n.exports.useState(""),N=n.exports.useCallback(async()=>{try{const e=await h.get(`/events/${a}`);p.current&&H(e.data)}catch(e){console.error(e),v("/404")}},[a,p,v]),C=n.exports.useCallback(async()=>{if(!!r)try{const e=await h.get(`/proofs?eventId=${a}&limit=1`);p.current&&e.data.proofs.length!==0&&D(e.data.proofs[0].id)}catch(e){console.error(e),y(e.message)}},[r,a,p]),F=n.exports.useCallback(async()=>{if(!!r)try{const e=await h.get(`/events/${a}/allowedNFTs`);p.current&&(L(e.data.list),R(e.data.list.map((s,i)=>s.tokenType==="ENS"?{id:i+1,eventId:a,tokenType:"ENS",ens:s.ens,accountENS:s.accountENS}:{id:i+1,eventId:a,tokenType:s.tokenType,chainId:s.chainId,contractAddress:s.contractAddress,tokenId:s.tokenId})))}catch(e){y(e.message),console.log(e)}},[a,r,p]),j=n.exports.useCallback(async()=>{if(!m||!a)return;A(!0);const e=f.find(s=>s.id===Number(m));if(!!e)try{const s=await h.get("/nonce",{params:{a:l}}),{nonce:i}=s.data;let u;e.tokenType==="ENS"?u={app:"OpenProof",operation:"proof generation",eventId:a,nonce:i,ens:e.ens}:u={app:"OpenProof",operation:"proof generation",eventId:a,nonce:i,nft:{chainId:e.chainId,tokenType:e.tokenType,contractAddress:e.contractAddress,tokenId:e.tokenId}};const q=await P({message:JSON.stringify(u,null,2)}),{data:K}=await h.post("/proofs",{message:u,signature:q});S("Proof Generated!",{variant:"success"}),v(`/proofs/${K.id}`)}catch(s){S("Process Failed",{variant:"error"}),y(s.message)}finally{A(!1)}},[S,l,a,f,m,P]),J=n.exports.useCallback(e=>{!f.find(i=>i.id===Number(e.target.value))||Y(e.target.value)},[f]);return n.exports.useEffect(()=>{N(),F(),C()},[N,F,C]),n.exports.useEffect(()=>{o&&l&&r?(o.host.addressOrEns===l||o.host.addressOrEns===E||o.managers&&o.managers.some(e=>e.address===l))&&T(!1):T(!0)},[o,l,E,r]),t(ne,{title:"Event Detail",children:c(ae,{maxWidth:B?!1:"lg",children:[t(oe,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:G,children:t(re,{color:"inherit"})}),t(me,{heading:"Event Details",links:[{name:"Events",href:ie.events.root}]}),o&&c($,{children:[t(ue,{post:o}),c(k,{sx:{p:{xs:3,md:2}},children:[t(O,{variant:"h6",sx:{mb:5},children:o.description}),c(M,{direction:"row",spacing:1.5,alignItems:"flex-end",sx:{flexGrow:1,mb:2},children:[!z&&t(x,{size:"large",fullWidth:!0,variant:"contained",color:"info",component:w,to:`/my/${a}/verify`,endIcon:t(b,{icon:"eva:edit-fill"}),children:"Verify"}),d&&r&&t(x,{fullWidth:!0,size:"large",variant:"contained",endIcon:t(b,{icon:"eva:checkmark-circle-2-fill"}),component:w,to:`/proofs/${d}`,children:"Your Proof"})]}),t(pe,{children:o.body})]})]}),o&&t($,{sx:{mt:3},children:c(k,{sx:{p:{xs:3,md:2}},children:[t(O,{variant:"h3",children:"Check your eligibility \u{1F680}"}),!d&&r&&I.length!==0&&c(fe,{fullWidth:!0,sx:{my:1},children:[t(he,{htmlFor:"grouped-select",children:"Your Available Tokens"}),t(ge,{value:m||"",label:"Tokens",onChange:J,children:f.map((e,s)=>{let i;if(e.tokenType==="ENS")i=`${e.accountENS}`;else{const u=`${e.contractAddress.slice(0,15)}..`;e.tokenId?i=`${u}/${e.tokenId}`:i=`${u}`}return t(ce,{value:e.id,children:i},s)})})]}),c(M,{direction:"row",spacing:1.5,alignItems:"flex-end",sx:{flexGrow:1,my:2},children:[r&&!d&&t(x,{fullWidth:!0,variant:"contained",size:"large",disabled:!(!d&&r&&I.length!==0),onClick:j,children:I.length!==0?"Join With Your Token":"You are not allowed"}),!r&&t(le,{signingMessage:{app:"openproof.app",operation:"login"},withCircularProgress:!0}),d&&r&&t(x,{fullWidth:!0,size:"large",variant:"contained",component:w,to:`/proofs/${d}`,endIcon:t(b,{icon:"eva:checkmark-circle-2-fill"}),children:"Your Proof"})]})]})}),!o&&!W&&t(xe,{})]})})}export{Te as default};
