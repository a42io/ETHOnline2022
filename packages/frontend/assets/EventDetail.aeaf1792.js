import{a as c,an as U,j as t,f as k,c as V,aR as Q,aF as X,r as n,u as Z,aG as _,aS as ee,aT as te,aH as se,d as h,P as ne,C as ae,aJ as oe,aK as re,as as $,T as M,S as O,B as x,L as w,I as b,M as ie,aU as ce}from"./index.8e2a867c.js";import{u as le}from"./useIsMountedRef.5e7322bb.js";import{j as de,M as ue,F as pe,I as fe,S as he}from"./EventNewEventForm.bd50e5b3.js";import{S as g}from"./Skeleton.12216c40.js";import"./icon_plan_premium.4c1aba0c.js";import"./illustration_404.4d2b5d39.js";import"./transition.1cb4ca21.js";import"./warn-once.58fe5bdf.js";function ge(){return c(U,{children:[t(g,{width:"100%",height:560,variant:"rectangular",sx:{borderRadius:2}}),c(k,{sx:{mt:3,display:"flex",alignItems:"center"},children:[t(g,{variant:"circular",width:64,height:64}),c(k,{sx:{flexGrow:1,ml:2},children:[t(g,{variant:"text",height:20}),t(g,{variant:"text",height:20}),t(g,{variant:"text",height:20})]})]})]})}function be(){const{themeStretch:W}=V(),p=le(),{eventId:a}=Q(),S=X(),[o,z]=n.exports.useState(null),{address:l}=Z(),{data:E}=_({address:l}),{isAuthenticated:r}=ee(),{signMessageAsync:T}=te(),{enqueueSnackbar:v}=se(),[B,y]=n.exports.useState(null),[G,N]=n.exports.useState(!0),[d,L]=n.exports.useState(""),[Y,P]=n.exports.useState(!1),[I,j]=n.exports.useState([]),[f,H]=n.exports.useState([]),[m,R]=n.exports.useState(""),A=n.exports.useCallback(async()=>{try{const e=await h.get(`/events/${a}`);p.current&&z(e.data)}catch(e){console.error(e),S("/404")}},[a,p,S]),C=n.exports.useCallback(async()=>{if(!!r)try{const e=await h.get(`/proofs?eventId=${a}&limit=1`);p.current&&e.data.proofs.length!==0&&L(e.data.proofs[0].id)}catch(e){console.error(e),y(e.message)}},[r,a,p]),F=n.exports.useCallback(async()=>{if(!!r)try{const e=await h.get(`/events/${a}/allowedNFTs`);p.current&&(j(e.data.list),H(e.data.list.map((s,i)=>s.tokenType==="ENS"?{id:i+1,eventId:a,tokenType:"ENS",ens:s.ens,accountENS:s.accountENS}:{id:i+1,eventId:a,tokenType:s.tokenType,chainId:s.chainId,contractAddress:s.contractAddress,tokenId:s.tokenId})))}catch(e){y(e.message),console.log(e)}},[a,r,p]),J=n.exports.useCallback(async()=>{if(!m||!a)return;P(!0);const e=f.find(s=>s.id===Number(m));if(!!e)try{const s=await h.get("/nonce",{params:{a:l}}),{nonce:i}=s.data;let u;e.tokenType==="ENS"?u={app:"openproof.app",operation:"proof generation",eventId:a,nonce:i,ens:e.ens}:u={app:"openproof.app",operation:"proof generation",eventId:a,nonce:i,nft:{chainId:e.chainId,tokenType:e.tokenType,contractAddress:e.contractAddress,tokenId:e.tokenId}};const q=await T({message:JSON.stringify(u,null,2)}),{data:K}=await h.post("/proofs",{message:u,signature:q});v("Proof Generated!",{variant:"success"}),S(`/proofs/${K.id}`)}catch(s){v("Process Failed",{variant:"error"}),y(s.message)}finally{P(!1)}},[v,l,a,f,m,T]),D=n.exports.useCallback(e=>{!f.find(i=>i.id===Number(e.target.value))||R(e.target.value)},[f]);return n.exports.useEffect(()=>{A(),F(),C()},[A,F,C]),n.exports.useEffect(()=>{o&&l&&r?(o.host.addressOrEns===l||o.host.addressOrEns===E||o.managers&&o.managers.some(e=>e.address===l))&&N(!1):N(!0)},[o,l,E,r]),t(ne,{title:"Event Detail",children:c(ae,{maxWidth:W?!1:"lg",children:[t(oe,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:Y,children:t(re,{color:"inherit"})}),o&&c($,{children:[t(de,{post:o}),c(k,{sx:{p:{xs:3,md:2}},children:[t(M,{variant:"h6",sx:{mb:5},children:o.description}),c(O,{direction:"row",spacing:1.5,alignItems:"flex-end",sx:{flexGrow:1,mb:2},children:[!G&&t(x,{size:"large",fullWidth:!0,variant:"contained",color:"info",component:w,to:`/my/${a}/verify`,endIcon:t(b,{icon:"eva:edit-fill"}),children:"Verify"}),d&&r&&t(x,{fullWidth:!0,size:"large",variant:"contained",endIcon:t(b,{icon:"eva:checkmark-circle-2-fill"}),component:w,to:`/proofs/${d}`,children:"Your Proof"})]}),t(ue,{children:o.body})]})]}),o&&t($,{sx:{mt:3},children:c(k,{sx:{p:{xs:3,md:2}},children:[t(M,{variant:"h3",children:"Check your eligibility \u{1F680}"}),!d&&r&&I.length!==0&&c(pe,{fullWidth:!0,sx:{my:1},children:[t(fe,{htmlFor:"grouped-select",children:"Your Available Tokens"}),t(he,{value:m||"",label:"Tokens",onChange:D,children:f.map((e,s)=>{let i;if(e.tokenType==="ENS")i=`${e.accountENS}`;else{const u=`${e.contractAddress.slice(0,15)}..`;e.tokenId?i=`${u}/${e.tokenId}`:i=`${u}`}return t(ie,{value:e.id,children:i},s)})})]}),c(O,{direction:"row",spacing:1.5,alignItems:"flex-end",sx:{flexGrow:1,my:2},children:[r&&!d&&t(x,{fullWidth:!0,variant:"contained",size:"large",disabled:!(!d&&r&&I.length!==0),onClick:J,children:I.length!==0?"Join With Your Token":"You are not allowed"}),!r&&t(ce,{signingMessage:{app:"openproof.app",operation:"login"},withCircularProgress:!0}),d&&r&&t(x,{fullWidth:!0,size:"large",variant:"contained",component:w,to:`/proofs/${d}`,endIcon:t(b,{icon:"eva:checkmark-circle-2-fill"}),children:"Your Proof"})]})]})}),!o&&!B&&t(ge,{})]})})}export{be as default};
